<div id="floatingNavContainer" class="floating-nav-container">
  <div id="floatingNav" class="floating-nav">
    <div class="floating-nav-content">
      <!-- Home -->
      <a href="/" class="nav-icon-btn" aria-label="Home" title="Home">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      </a>
      
      <!-- Copy link -->
      <button id="copyLinkBtn" class="nav-icon-btn" aria-label="Copy link" title="Copy link">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
      </button>
      
      <div class="nav-divider"></div>
      
      <!-- Previous/Next patent navigation -->
      <% if (typeof previousPatent !== 'undefined' && previousPatent) { %>
        <a href="/patent/<%= previousPatent.patent_number %>" class="nav-icon-btn" aria-label="Previous patent" title="Previous patent">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        </a>
      <% } else { %>
        <button class="nav-icon-btn" disabled aria-label="No previous patent">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        </button>
      <% } %>
      
      <% if (typeof nextPatent !== 'undefined' && nextPatent) { %>
        <a href="/patent/<%= nextPatent.patent_number %>" class="nav-icon-btn" aria-label="Next patent" title="Next patent">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </a>
      <% } else { %>
        <button class="nav-icon-btn" disabled aria-label="No next patent">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      <% } %>
      
      <div class="nav-divider"></div>
      
      <!-- Social share buttons -->
      <!-- Twitter/X -->
      <a href="#" id="shareX" class="nav-icon-btn" target="_blank" rel="noopener noreferrer" aria-label="Share on X" title="Share on X">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4l11.733 16h4.267l-11.733 -16z"/><path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"/></svg>
      </a>
      
      <!-- LinkedIn -->
      <a href="#" id="shareLinkedIn" class="nav-icon-btn" target="_blank" rel="noopener noreferrer" aria-label="Share on LinkedIn" title="Share on LinkedIn">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
      </a>
      
      <!-- Facebook -->
      <a href="#" id="shareFacebook" class="nav-icon-btn" target="_blank" rel="noopener noreferrer" aria-label="Share on Facebook" title="Share on Facebook">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
      </a>
      
      <!-- Bluesky -->
      <a href="#" id="shareBluesky" class="nav-icon-btn" target="_blank" rel="noopener noreferrer" aria-label="Share on Bluesky" title="Share on Bluesky">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z"/></svg>
      </a>
      
      <!-- Hacker News -->
      <a href="#" id="shareHackerNews" class="nav-icon-btn" target="_blank" rel="noopener noreferrer" aria-label="Share on Hacker News" title="Share on Hacker News">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0v24h24V0H0zm12.2 13.9v5.3h-1.6v-5.3L6.5 4.4h1.8l3.2 7.6 3.1-7.6h1.8l-4.2 9.5z"/></svg>
      </a>
      
      <!-- Reddit -->
      <a href="#" id="shareReddit" class="nav-icon-btn" target="_blank" rel="noopener noreferrer" aria-label="Share on Reddit" title="Share on Reddit">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9.5" cy="9" r="1"/><circle cx="14.5" cy="9" r="1"/><path d="M12 17c-2.5 0-4.5-1.5-4.5-3.5"/><path d="M12 3c5.5 0 10 4.5 10 10s-4.5 10-10 10S2 18.5 2 13 6.5 3 12 3z"/></svg>
      </a>
      
      <!-- WhatsApp -->
      <a href="#" id="shareWhatsApp" class="nav-icon-btn" target="_blank" rel="noopener noreferrer" aria-label="Share on WhatsApp" title="Share on WhatsApp">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21l1.65-3.8a9 9 0 1 1 3.4 2.9L3 21"/><path d="M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0v1a5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"/></svg>
      </a>
    </div>
  </div>
</div>

<style>
.floating-nav-container {
  width: 100%;
  position: relative;
  display: flex;
  justify-content: center;
  margin-top: 10px;
  margin-bottom: 10px;
}

.floating-nav {
  width: auto;
  max-width: 600px;
  transition: all 0.2s ease;
}

.floating-nav.is-floating {
  position: fixed;
  bottom: 1.5rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 50;
  width: auto;
  max-width: 600px;
  animation: slideUp 0.2s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

.floating-nav-content {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2px;
  padding: 4px;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(8px);
  border: 1px solid #e5e7eb;
  border-radius: 8px;
}

.floating-nav.is-floating .floating-nav-content {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.nav-icon-btn {
  padding: 6px;
  border-radius: 9999px;
  border: none;
  background: transparent;
  color: #6b7280;
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
}

.nav-icon-btn:hover:not(:disabled) {
  background: rgba(0, 0, 0, 0.05);
  color: #111827;
}

.nav-icon-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.nav-icon-btn .icon {
  width: 16px;
  height: 16px;
}

.nav-divider {
  height: 12px;
  width: 1px;
  background: #e5e7eb;
  margin: 0 2px;
}

@media (max-width: 768px) {
  .floating-nav.is-floating {
    max-width: calc(100% - 3rem);
  }
}
</style>

<script>
(function() {
  const container = document.getElementById('floatingNavContainer');
  const nav = document.getElementById('floatingNav');
  const copyBtn = document.getElementById('copyLinkBtn');
  
  // Initialize share URLs
  const currentUrl = window.location.href;
  const encodedUrl = encodeURIComponent(currentUrl);
  const patentTitle = document.querySelector('h1')?.textContent || 'Patent';
  const encodedTitle = encodeURIComponent(patentTitle);
  
  // Set share URLs
  document.getElementById('shareX').href = `https://x.com/intent/post?text=${encodedTitle}&url=${encodedUrl}`;
  document.getElementById('shareLinkedIn').href = `https://linkedin.com/sharing/share-offsite?url=${encodedUrl}&text=${encodedTitle}`;
  document.getElementById('shareFacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
  document.getElementById('shareBluesky').href = `https://bsky.app/intent/compose?text=${encodedTitle}+${encodedUrl}`;
  document.getElementById('shareHackerNews').href = `https://news.ycombinator.com/submitlink?u=${encodedUrl}&t=${encodedTitle}`;
  document.getElementById('shareReddit').href = `https://reddit.com/submit?url=${encodedUrl}&title=${encodedTitle}`;
  document.getElementById('shareWhatsApp').href = `https://api.whatsapp.com/send?text=${encodedTitle}+${encodedUrl}`;
  
  // Copy link functionality
  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(currentUrl).then(() => {
      const originalHTML = copyBtn.innerHTML;
      copyBtn.innerHTML = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';
      setTimeout(() => {
        copyBtn.innerHTML = originalHTML;
      }, 2000);
    });
  });
  
  // Floating behavior
  let isFloating = false;
  let reachedEnd = false;
  
  function handleScroll() {
    if (!nav || !container) return;
    
    const containerRect = container.getBoundingClientRect();
    const navRect = nav.getBoundingClientRect();
    const viewportHeight = window.innerHeight;
    const navHeight = navRect.height;
    
    // Start floating immediately
    const shouldFloat = true;
    
    // Check if we've reached the end of the container
    const containerBottom = containerRect.bottom;
    const shouldStopFloating = containerBottom <= viewportHeight + navHeight;
    
    if (shouldFloat && !shouldStopFloating && !isFloating) {
      nav.classList.add('is-floating');
      isFloating = true;
    } else if ((!shouldFloat || shouldStopFloating) && isFloating) {
      nav.classList.remove('is-floating');
      isFloating = false;
    }
    
    reachedEnd = shouldStopFloating;
  }
  
  // Initial check
  handleScroll();
  setTimeout(handleScroll, 300);
  
  window.addEventListener('scroll', handleScroll);
  window.addEventListener('resize', handleScroll);
})();
</script>
