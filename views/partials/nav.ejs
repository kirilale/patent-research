<nav class="nav">
    <a href="/" class="logo">Future of Gaming</a>
    <div class="nav-links">
        <a href="/archive">Archive</a>
        <a href="/about">About</a>
        <% if (typeof user !== 'undefined' && user) { %>
            <div class="user-menu">
                <button class="user-avatar" id="userAvatarBtn">
                    <% if (user.image) { %>
                        <img src="<%= user.image %>" alt="<%= user.name || user.email %>">
                    <% } else { %>
                        <%= (user.name || user.email).charAt(0).toUpperCase() %>
                    <% } %>
                </button>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-dropdown-header">
                        <div class="user-dropdown-email"><%= user.email %></div>
                    </div>
                    <a href="/settings" class="user-dropdown-item">Settings</a>
                    <form action="/api/auth/sign-out" method="POST" id="logoutForm">
                        <button type="submit" class="user-dropdown-item user-dropdown-logout">Sign Out</button>
                    </form>
                </div>
            </div>
            <script>
                // Avatar dropdown toggle
                const avatarBtn = document.getElementById('userAvatarBtn');
                const dropdown = document.getElementById('userDropdown');
                
                avatarBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    dropdown.classList.toggle('show');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', () => {
                    dropdown.classList.remove('show');
                });

                // Logout handler
                const logoutForm = document.getElementById('logoutForm');
                logoutForm.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    try {
                        const response = await fetch('/api/auth/sign-out', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include'
                        });
                        if (response.ok) {
                            // Force hard reload to clear any cached session data
                            window.location.replace('/');
                            window.location.reload(true);
                        }
                    } catch (error) {
                        console.error('Logout error:', error);
                        // Force hard reload even on error
                        window.location.replace('/');
                        window.location.reload(true);
                    }
                    return false;
                });
            </script>
        <% } else { %>
            <a href="/login" class="subscribe-btn">Login</a>
        <% } %>
    </div>
</nav>
